<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kamate</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <style>
        thead,
        tfoot {
            background-color: #3f87a6;
            color: #fff;
        }

        tbody {
            background-color: #e4f0f5;
        }

        caption {
            padding: 10px;
            caption-side: bottom;
        }

        table {
            border-collapse: collapse;
            border: 2px solid rgb(200, 200, 200);
            letter-spacing: 1px;
            font-family: sans-serif;
            font-size: .8rem;
        }

        td,
        th {
            border: 1px solid rgb(190, 190, 190);
            padding: 5px 10px;
        }

        td {
            text-align: center;
        }

        .wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
        }

    </style>
</head>
<body>
<div id="kamatnjak">
    <div>
        <label for="kamata">Kamata</label>
        <input v-model="kamata" id="kamata" type="number" step="any">
    </div>

    <div>
        <label for="rata">Broj rata (mjeseci)</label>
        <input v-model="rata" id="rata" type="number">
    </div>

    <div>
        <label for="glavnica">Iznos glavnice</label>
        <input v-model="glavnica" id="glavnica" type="number">
    </div>

    <div class="wrapper">
        <div>
            <h1>Anuiteti</h1>

            <h2>Mjese훾ni obrok tj. anuitet: {{ prviAnuitet }}</h2>
            <table>
                <thead>
                <tr>
                    <th>RB</th>
                    <th>Glavnica</th>
                    <th>Kamata</th>
                    <th>Mjese훾ni obrok</th>
                    <th>Nedospjela Glavnica</th>
                </tr>
                </thead>
                <tbody>
                <tr v-for="i in rata">
                    <td>{{ i }}</td>
                    <td>{{ glavnicaZaMjesecAnuitet(i) }}</td>
                    <td>{{ kamataZaMjesecAnuitet(i) }}</td>
                    <td>{{ prviAnuitet }}</td>
                    <td>{{ nedospijelaGlavnicaAnuitet(i) }}</td>
                </tr>
                </tbody>

                <tfoot>
                <tr>
                    <th>UKUPNO:</th>
                    <th>{{ glavnica }}</th>
                    <th>{{ ukupnoKamataAnuitet }}</th>
                    <th>{{ ukupnoAnuitet }}</th>
                    <th></th>
                </tr>
                </tfoot>
            </table>
        </div>

        <div>
            <h1>Rate</h1>

            <h2>Prvi mjese훾ni obrok tj. rata: {{ prvaRata }}</h2>

            <table>
                <thead>
                <tr>
                    <th>RB</th>
                    <th>Glavnica</th>
                    <th>Kamata</th>
                    <th>Mjese훾ni obrok</th>
                    <th>Nedospjela Glavnica</th>
                </tr>
                </thead>
                <tbody>
                <tr v-for="i in rata">
                    <td>{{ i }}</td>
                    <td>{{ glavnicaZaMjesec() }}</td>
                    <td>{{ kamataZaMjesec(i) }}</td>
                    <td>{{ rataZaMjesec(i) }}</td>
                    <td>{{ nedospijelaGlavnica(i) }}</td>
                </tr>
                </tbody>
                <tfoot>
                <tr>
                    <th>UKUPNO:</th>
                    <th>{{ glavnica }}</th>
                    <th>{{ ukupnoKamataRate }}</th>
                    <th>{{ glavnica + ukupnoKamataRate}}</th>
                    <th></th>
                </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>

</body>
<script>
    var app = new Vue({
        el: '#kamatnjak',
        data: {
            kamata: 2.19,
            rata: 240,
            glavnica: 710000,
        },
        computed: {
            prviAnuitet: function () {

                var r = (this.kamata / 100) + 1
                var r2 = Math.pow(r, 1 / 12);
                var n = this.rata;
                var C0 = this.glavnica;

                var b = Math.pow(r2, n);

                var result = C0 * ((b * (r2 - 1)) / (b - 1));

                return Math.round(result * 100) / 100;
            },
            prvaRata: function () {
                var C0 = this.glavnica;
                var r = (this.kamata / 100);
                var n = this.rata;
                var g = C0 / n;
                var k = (C0 * r) / 12;

                var result = g + k;

                return Math.round(result * 100) / 100;
            },
            ukupnoKamataRate: function () {
                var kamata = 0

                for (var i = 1; i <= parseInt(this.rata); i++) {
                    kamata += this.kamataZaMjesec(i)
                }

                return kamata
            },
            ukupnoKamataAnuitet: function () {
                var kamata = 0

                for (var i = 1; i <= parseInt(this.rata); i++) {
                    kamata += this.kamataZaMjesecAnuitet(i)
                }

                var result =  kamata

                return Math.round(result * 100) / 100;
            },
            ukupnoAnuitet: function () {
                var result  = this.glavnica + this.ukupnoKamataAnuitet;

                return Math.round(result * 100) / 100;
            },
            ukupnoRata: function () {
                var result  = this.glavnica + this.ukupnoKamataRate;

                return Math.round(result * 100) / 100;
            }
        },
        methods: {
            glavnicaZaMjesec: function () {
                var C0 = this.glavnica;
                var n = this.rata;
                var g = C0 / n;

                return Math.round(g * 100) / 100;
            },
            kamataZaMjesec: function (mjesec) {
                var n = this.rata;
                var C0 = this.glavnica;
                var g = C0 / n;
                var C1 = C0 - (g * (mjesec - 1));
                var r = this.kamata / 100;
                var k = (C1 * r) / 12;

                return Math.round(k * 100) / 100;
            },
            rataZaMjesec: function (mjesec) {
                return Math.round((this.glavnicaZaMjesec() + this.kamataZaMjesec(mjesec)) * 100) / 100;
            },
            nedospijelaGlavnica: function (mjesec) {
                var n = this.rata;
                var C0 = this.glavnica;
                var g = C0 / n;
                var C1 = C0 - (g * (mjesec));

                return Math.round(C1 * 100) / 100;
            },
            nedospijelaGlavnicaAnuitet: function (mjesec) {
                var r = (this.kamata / 100) + 1
                var r2 = Math.pow(r, 1 / 12);
                var n = this.rata;
                var C0 = this.glavnica;

                var b = Math.pow(r2, n);

                var A = C0 * ((b * (r2 - 1)) / (b - 1));

                var p = n - mjesec;

                var result = A * ((Math.pow(r2, p) - 1) / (Math.pow(r2, p) * (r2 - 1)));

                return Math.round(result * 100) / 100;
            },

            kamataZaMjesecAnuitet: function (mjesec) {
                var r = (this.kamata / 100) / 12;
                var result = this.nedospijelaGlavnicaAnuitet(mjesec - 1) * r;

                return Math.round(result * 100) / 100;
            },


            glavnicaZaMjesecAnuitet: function (mjesec) {
                var result = this.prviAnuitet - this.kamataZaMjesecAnuitet(mjesec);

                return Math.round(result * 100) / 100;
            },
        }
    })
</script>
</html>
